<div ng-controller="BillController" style="font-family:Arial, sans-serif; color:#333; position:relative;">

  <!-- Reusable Styles (same look as Payment page) -->
  <style>
    .payment-table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #c7c7c7;
        background: #fff;
        margin-top: 15px;
    }

    .payment-table th {
        background: #2B547D;
        color: #fff;
        padding: 12px;
        text-align: left;
        border-right: 1px solid #e2e2e2;
        font-weight: bold;
    }

    .payment-table td {
        padding: 10px 12px;
        border-bottom: 1px solid #dcdcdc;
        border-right: 1px solid #eaeaea;
        background: #fafafa;
        vertical-align: middle;
    }

    .payment-table th:last-child,
    .payment-table td:last-child {
        border-right: none;
    }

    .payment-table tr:hover {
        background: #f5f8fc;
    }

    .actions {
        display: flex;
        gap: 8px;
        justify-content: center;
    }

    .btn-edit {
        padding: 4px 10px;
        background: #4CAF50;
        color: #fff;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
    }

    .btn-delete {
        padding: 4px 10px;
        background: #E74C3C;
        color: #fff;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
    }

    /* Popup common */
    .floating-popup {
        position: absolute;
        top: 140px;
        right: 0;
        width: 360px;
        padding: 20px;
        background: #fff;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 200;
    }
    .floating-popup h4 { margin-top: 0; margin-bottom: 16px; }
    .floating-popup label { display:block; margin-bottom:6px; font-weight:600; }
    .floating-popup input[type="text"],
    .floating-popup input[type="number"],
    .floating-popup input[type="date"] {
      width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; margin-bottom:12px;
    }
  </style>

  <!-- HEADER: Title + Search + Add -->
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <h3 style="margin:0; color:#2B547D;">Bill List</h3>

    <div style="display:flex; align-items:center; gap:10px;">
      <div style="position:relative;">
        <input type="text" ng-model="searchBillText" placeholder="Search..." 
               style="padding:6px 30px 6px 10px; border:1px solid #ccc; border-radius:4px; width:200px;">
        <i class="fas fa-search" style="position:absolute; right:8px; top:50%; transform:translateY(-50%); color:#777; cursor:pointer;"></i>
      </div>

      <button ng-click="openAddPopup()" 
              style="padding:8px 15px; background:#2B547D; color:#fff; border:none; border-radius:4px; cursor:pointer;">
        + Add
      </button>
    </div>
  </div>

  <!-- ADD BILL POPUP (existing) -->
  <div ng-show="showAddPopup" class="floating-popup" style="right:0; border:2px solid #2B547D;">
    <h4 style="color:#2B547D;">Add Bill</h4>
    <form ng-submit="addBill()">
      <label>Patient ID</label>
      <input type="number" ng-model="newBill.patient_id" placeholder="Patient ID" required>

      <label>Services/Tax</label>
      <input type="text" ng-model="newBill.services_tax" placeholder="Services/Tax">

      <label>Total Amount</label>
      <input type="number" ng-model="newBill.total_amount" placeholder="Total Amount">

      <label>Paid Bill</label>
      <input type="number" ng-model="newBill.paid_bill" placeholder="Paid Bill">

      <label>Remaining Bill</label>
      <input type="number" ng-model="newBill.remaining_bill" placeholder="Remaining Bill">

      <div style="text-align:right;">
        <button type="button" ng-click="closeAddPopup()" style="margin-right:8px; padding:6px 12px; border:none; border-radius:4px; background:#7F9DB9; color:#fff; cursor:pointer;">Cancel</button>
        <button type="submit" style="padding:6px 12px; border:none; border-radius:4px; background:#2B547D; color:#fff; cursor:pointer;">Add</button>
      </div>
    </form>
  </div>

  <!-- EDIT BILL POPUP (new) -->
  <div ng-show="showEditBillPopup" class="floating-popup" style="right:150px; border:2px solid #4CAF50;">
    <h4 style="color:#4CAF50;">Edit Bill</h4>
    <form ng-submit="updateBill()">
      <label>Bill ID</label>
      <input type="text" ng-model="editBill.bill_id" readonly>

      <label>Patient ID</label>
      <input type="number" ng-model="editBill.patient_id" required>

      <label>Services/Tax</label>
      <input type="text" ng-model="editBill.services_tax">

      <label>Total Amount</label>
      <input type="number" ng-model="editBill.total_amount">

      <label>Paid Bill</label>
      <input type="number" ng-model="editBill.paid_bill">

      <label>Remaining Bill</label>
      <input type="number" ng-model="editBill.remaining_bill">

      <div style="text-align:right;">
        <button type="button" ng-click="closeEditBillPopup()" style="margin-right:8px; padding:6px 12px; border:none; border-radius:4px; background:#7F9DB9; color:#fff; cursor:pointer;">Cancel</button>
        <button type="submit" style="padding:6px 12px; border:none; border-radius:4px; background:#4CAF50; color:#fff; cursor:pointer;">Update</button>
      </div>
    </form>
  </div>

  <!-- BILL TABLE -->
  <div class="table-container" style="margin-top:20px; overflow-x:auto;">
    <table class="payment-table">
      <thead>
        <tr>
          <th style="width:10%;">Bill ID</th>
          <th style="width:15%;">Patient ID</th>
          <th style="width:25%;">Services/Tax</th>
          <th style="width:15%;">Total Amount</th>
          <th style="width:15%;">Paid Bill</th>
          <th style="width:15%;">Remaining Bill</th>
          <th style="width:10%; text-align:center;">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr ng-repeat="bill in pagedBills() | filter:searchBillText">
          <td>{{ bill.bill_id }}</td>
          <td>{{ bill.patient_id }}</td>
          <td>{{ bill.services_tax }}%</td>
          <td>{{ bill.total_amount }}</td>
          <td>{{ bill.paid_bill }}</td>
          <td>{{ bill.remaining_bill }}</td>

          <td>
            <div class="actions">
              <button class="btn-edit" ng-click="openEditBillPopup(bill)">Edit</button>
              <button class="btn-delete" ng-click="deleteBill(bill.bill_id)">Delete</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination" style="margin-top:15px; text-align:right;">
      <button ng-disabled="currentPage == 1" ng-click="prevPage()" style="padding:6px 12px; margin-right:5px; background:#2B547D; color:#fff; border:none; border-radius:4px;">Prev</button>
      <span style="margin:0 10px; font-weight:bold;">Page {{ currentPage }} of {{ totalPages() }}</span>
      <button ng-disabled="currentPage == totalPages()" ng-click="nextPage()" style="padding:6px 12px; background:#2B547D; color:#fff; border:none; border-radius:4px;">Next</button>
    </div>
  </div>

</div>
